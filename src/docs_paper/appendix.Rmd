---
title: Appendix to "Spatio-temporal estimates of HIV risk group proportions for adolescent
  girls and young women across 13 priority countries in sub-Saharan Africa"
output:
  pdf_document:
    keep_tex: true
    includes:
      in_header: preamble.tex
bibliography: citations.bib
---

\newpage

# Statistical modelling of risk group proportions

## Overview

We index the four risk groups given in Table by $k \in \{1, 2, 3, 4\}$ and we denote being in either the third or fourth risk group by $k = 3^{+}$.
Let $c \in \{1, \ldots, 13\}$ denote the 13 studied AGYW priority countries, each partitioned into districts.
For each district $i \in \{1, \ldots, n\}$, year $t \in \{1999, \ldots, 2018\}$, age category $a \in \{\text{15--19}, \text{20--24}, \text{25--29}\}$, and risk group $k \in \{1, 2, 3^{+}\}$ we consider a multinomial random vector
\begin{equation}
    \y_{ita} = (y_{ita1}, \ldots, y_{ita3^{+}})^\top \sim \text{Multinomial}(m_{ita}; \, p_{ita1}, \ldots, p_{ita3^{+}}).
\end{equation}
The number of women in risk group $k$ is $y_{itak}$ and the sample size is $m_{ita} = \sum_{k = 1}^{3^{+}} y_{itak}$, where $p_{itak} > 0$ is the probability of membership of the $k$th risk group with $\sum_{k = 1}^{3^{+}} p_{itak} = 1$.
To efficiently model this data we used the multinomial-Poisson transformation, which allows multinomial logistic regression models to be cast as equivalent Poisson log-linear models [@baker1994multinomial; @lee2017poisson]
\begin{align}
    y_{itak} &\sim \text{Poisson}(\kappa_{itak}), \label{eq:poisson} \\
    \log(\kappa_{itak}) &= \eta_{itak}, \label{eq:linearpredictor}
\end{align}
for particular choice of the linear predictor $\eta_{itak}$, described in more detail in Section.

To estimate the proportion of those in the $k = 3^{+}$ risk group that were respectively in the $k = 3$ and $k = 4$ risk groups, we fit a separate logistic regression model of the form
\begin{align}
    y_{ia4} &\sim \text{Binomial} \left( y_{ia3} + y_{ia4}, q_{ia} \right), \\
    q_{ia} &= p_{ia4} / (p_{ia3} + p_{ia4}) = p_{ia4} / p_{ia{3^+}}, \\
    q_{ia} &= \text{logit}^{-1} \left( \eta_{ia} \right), 
\end{align}
for choice of the linear predictor $\eta_{ia}$, described in more detail in Section.
This approach allowed us to include all surveys in the multinomial regression model, but only those surveys with a specific transactional sex question to estimate the proportions $\{p_{ia4}\}$.
As all such surveys occurred in 2013-2018, $q_{ia}$ was assumed to be constant over time.

To quantify uncertainty from our model, we took posterior samples $s = 1, \ldots, 1000$ from each of the multinomial $\{p_{itak}^s\}$ and logistic regression $\{q_{ia}^s\}$ models.
Samples $p_{ita3}^s$ and $p_{ita4}^s$ were then generated by splitting samples from the $k = 3^{+}$ category of the multinomial model via
\begin{align*}
    p_{ita3}^s &= (1 - q_{ia}^s)p_{ita{3^+}^s}, \\
    p_{ita4}^s &= q_{ia}^s p_{ita{3^+}}^s.
\end{align*}
As transactional sex is too inclusive to directly correspond to sex work [@wamoyi2016transactional], we adjusted our samples so that the population size estimates for FSW aggregated to a national level matched those of @stevens2022estimating.
In making this adjustment, we assumed that subnational variation in the FSW proportion corresponds to that of the transactional sex proportion.
We calculated the mean, median, 2.5\% and 97.5\% quantiles for the risk group probabilities empirically using these adjusted samples.
To produce aggregated estimates, such as the age category 15-24 and national estimates, we weighted the adjusted samples by population sizes $N_{ita} = \sum_k N_{itak}$ obtained from the Naomi model [@eaton2021naomi].

## Multinomial regression model

### The multinomial-Poisson transformation

The multinomial-Poisson transformation reframes a given multinomial logisitic regression model as an equivalent Poisson log-linear model of the form
\begin{align}
    y_{itak} &\sim \text{Poisson}(\kappa_{itak}), \\
    \log(\kappa_{itak}) &= \eta_{itak},
\end{align}
for suitable choice of linear predictor $\eta_{itak}$.
Category probabilities are then obtained by applying the softmax function to the linear predictor as follows
\begin{equation}
    p_{itak} = \frac{\exp(\eta_{itak})}{\sum_{k = 1}^{3^{+}} \exp(\eta_{itak})} = \frac{\kappa_{itak}}{\sum_{k = 1}^{3^{+}} \kappa_{itak}}.
\end{equation}
In the equivalent model, the sample sizes $m_{ita} = \sum_k y_{itak}$ are treated as random rather than fixed as they would be in the multinomial logistic regression model.
In particular, following Equation, the sample sizes follow a Poisson distribution
\begin{equation}
    m_{ita} \sim \text{Poisson} \left( \kappa_{ita} \right),
\end{equation}
where the intensity $\kappa_{ita} = \sum_k \kappa_{itak}$ is given by a sum of intensities over each category.
The basis of the Poisson trick is that, conditional on their sum, Poisson counts are jointly multinomially distributed [@mccullagh1989generalized]
\begin{equation}
    \mathbf{y}_{ita} \, | \, m_{ita} \sim \text{Multinomial} \left( m_{ita}; \frac{\kappa_{ita1}}{\kappa_{ita}}, \ldots, \frac{\kappa_{itaK}}{\kappa_{ita}} \right).
\end{equation}
As such, the joint distribution of $p(\mathbf{y}_{ita}, m_{ita})$ is
\begin{align}
p(m_{ita}) p(\mathbf{y}_{ita} \, | \, m_{ita}) 
&= \exp(-\kappa_{ita}) \frac{(\kappa_{ita})^{m_{ita}}}{m_{ita}!} \times \frac{m_{ita}!}{\prod_k y_{itak}!} \prod_k \left( \frac{\kappa_{itak}}{\kappa_{ita}} \right)^{y_{itak}} \\
&= \prod_k \left( \frac{\exp(-\kappa_{itak}) \left( \kappa_{itak} \right)^{y_{itak}}}{y_{itak}!} \right) \\
&= \prod_k \text{Poisson} \left( y_{itak} \, | \, \kappa_{itak} \right). \label{eq:prodpoisson}
\end{align}
Equation corresponds to the product of $K$ independent Poisson likelihoods, and the joint distribution over all the data $\{\mathbf{y}_{ita}, m_{ita}\}_{i, t, a}$ is given by $\prod_{i, t, a, k} \text{Poisson} \left( y_{itak} \, | \, \kappa_{itak} \right)$.
The Poisson log-linear model, which vicariously includes the sample sizes as random, is equivalent only when these normalisation constants are recovered exactly by the model.
To ensure that this is the case, we included observation-specific random effects $\theta_{ita}$ in the equation for the linear predictor in every model we considered.
Multiplying each of $\{\kappa_{itak}\}_{k = 1}^K$ by $\exp(\theta_{ita})$ has no effect on the multinomial probabilities, but does provide the flexibility required for $\kappa_{ita}$ to exactly recover $m_{ita}$ as desired.
Although in theory an improper prior $\theta_{ita} \propto 1$ should be used, in practise, by keeping $\eta_{ita}$ small so that arbitrarily large values of the observation-specific random effects $\theta_{ita}$ are not required, it is sufficient (and practically preferable for inference) to instead use a vague prior.
As such, we set $\theta_{ita} \sim \mathcal{N}(0, \tau_\theta^{-1})$, with fixed precision $\tau_\theta = 0.000001$ (or a standard deviation of $\sigma_\theta = 1000$).

### Model specifications

We considered eight models (Table~\ref{tab:multinomial-models}) for $\eta_{ita}$ of the form $\eta_{ita} = \theta_{ita} + \beta_k + \alpha_{ak} + \zeta_{ck} + \phi_{ik} + \gamma_{tk} + \delta_{itk}$.
Observation random effects $\theta_{ita}$ with a diffuse prior, $\mathcal{N}(0, 1000^2)$, were included in every model to ensure the sample sizes $m_{ita}$ were recovered exactly, as required for the Poisson log-linear model to be equivalent to the multinomial logistic regression.
To capture age-specific proportion estimates for each category $k = 1, 2, 3^{+}$, we included category random effects $\beta_k \sim \mathcal{N}(0, \tau_\beta^{-1})$ and age-category random effects $\alpha_{ak} \sim \mathcal{N}(0, \tau_\alpha^{-1})$.
Owing to country-level heterogeneity in the data, we also included country-category random effects $\zeta_{ck} \sim \mathcal{N}(0, \tau_\zeta^{-1})$.
We considered two specifications, independent and identically distributed (IID) and Besag, for the space-category $\phi_{ik}$ random effects and two specifications, IID and first order autoregressive (AR1), for the year-category $\gamma_{tk}$ random effects, as well as separable space-year-category interactions $\delta_{itk}$ with corresponding Kronecker product structure.
All random effect precision parameters $\tau \in \{\tau_\beta, \tau_\alpha, \tau_\zeta, \tau_\phi, \tau_\gamma\, \tau_\delta\}$ were given independent penalised complexity (PC) priors [@simpson2017penalising] with base model $\sigma = 0$ given by $p(\tau) = 0.5 \nu \tau^{-3/2} \exp \left( - \nu \tau^{-1/2} \right)$
where $\nu = - \ln(0.01) / 2.5$ such that  $\mathbb{P}(\sigma > 2.5) = 0.01$.

To ensure interpretable posterior inferences of random effect contribution, we applied sum-to-zero constraints such that the age-category, country-category, space-category and year-category random effects did not alter overall category probabilities.
For the space-year-category random effects, we analogously applied sum-to-zero constraints to maintain roles of the space-category and year-category random effects.
Together, these were\footnote{The constraints for the space-year-category random effects were unable to be implemented fully, though this only effects the variance components interpretation.}:
\begin{enumerate}
    \item Category $\sum_k \beta_k = 0$
    \item Age $\sum_a \alpha_{ak} = 0, \, \forall \, k$
    \item Country $\sum_c \zeta_{ck} = 0, \, \forall \, k$
    \item Spatial $\sum_i \phi_{ik} = 0, \, \forall \, k$
    \item Temporal $\sum_t \gamma_{tk} = 0, \, \forall \, k$
    \item Spatio-temporal $\sum_i \delta_{itk} = 0, \, \forall \, t, k;
\quad \sum_t \delta_{itk} = 0, \, \forall \, i, k;
\quad \sum_k \delta_{itk} = 0, \, \forall \, i, t$
\end{enumerate}

#### Spatial random effects \label{sec:spatial-random-effects}

The specifications we considered for the space-category random effects were IID $\phi_{ik} \sim \mathcal{N}(0, \tau_\phi^{-1})$ and Besag grouped by category
$$
\bphi = (\phi_{11}, \ldots, \phi_{n1}, \ldots, \phi_{1K}, \ldots \phi_{nK})^\top \sim \mathcal{N}(\mathbf{0}, (\tau_\phi \mathbf{R}^\star_\phi)^{-})
$$
where the scaled structure matrix $\mathbf{R}^\star_\phi = \mathbf{R}^\star_b \otimes \mathbf{I}$ is given by the Kronecker product of the scaled Besag structure matrix $\mathbf{R}^\star_b$ and the identity matrix $\mathbf{I}$.
Scaling of the structure matrix to have generalised variance one ensures interpretable priors may be placed on the precision parameter [@sorbye2014scaling].
We follow the further recommendations of @freni2018note with regard to disconnected adjacency graphs, singletons and constraints.
The Besag structure matrix $\mathbf{R}_b$ is obtained by the precision matrix of the random effects $\mathbf{b} = (b_1, \ldots, b_n)^\top$ with the full conditionals
\begin{equation}
b_i \, | \, \mathbf{b}_{-i} \sim \N\left(\frac{\sum_{j: j \sim i} b_j}{n_{\delta i}}, \frac{1}{n_{\delta i}}\right),
\end{equation}
where $j \sim i$ if the districts $A_i$ and $A_j$ are adjacent, and $n_{\delta i}$ is the number of districts adjacent to $A_i$.

In preliminary testing, we tried excluding spatial random effects from the model, but found that this negatively effected performance.
We also tried using the BYM2 model [@simpson2017penalising] in place of the Besag, but found that the proportion parameter posteriors tended to be highly peaked at the value one.
For simplicity and to avoid numerical issues, by instead using Besag random effects we decided to fix this proportion to one, rather than learn it.

#### Temporal random effects \label{sec:temporal-random-effects}

The specifications we considered for the survey-category random effects were IID $\phi_{tk} \sim \mathcal{N}(0, \tau_\phi^{-1})$ and AR1 grouped by category
$$
\bm{\gamma} = (\gamma_{11}, \ldots, \gamma_{1K}, \ldots, \gamma_{T1}, \ldots, \gamma_{TK})^\top \sim \mathcal{N}(\mathbf{0}, (\tau_\phi \mathbf{R}^\star_\gamma)^{-})
$$
where the scaled structure matrix $\mathbf{R}^\star_\gamma = \mathbf{R}^\star_r \otimes \mathbf{I}$ is given by the Kronecker product of a scaled AR1 structure matrix $\mathbf{R}^\star_r$ and the identity matrix $\mathbf{I}$.
The AR1 structure matrix $\mathbf{R}_r$ is obtained by precision matrix of the random effects $\mathbf{r} = (r_1, \ldots, r_T)^\top$ specified by
\begin{align}
r_1 &\sim \left( 0, \frac{1}{1 - \rho^2} \right), \\
r_t &= \rho r_{t - 1} + \epsilon_t, \quad t = 2, \ldots, T, 
\end{align}
where $\epsilon_t \sim \mathcal{N}(0, 1)$ and $|\rho| < 1$.
For the lag-one correlation parameter $\rho$, we used the PC prior, as derived by @sorbye2017penalised, with base model $\rho = 1$ and condition $\mathbb{P}(\rho > 0 = 0.75)$.
We chose a base model corresponding to no change in behaviour over time, rather than the alternative $\rho = 0$ corresponding to no correlation in behaviour over time, as we judged the former to be more plausible a priori.

#### Spatio-temporal random effects \label{sec:spatio-temporal-random-effects}

For each model including spatio-temporal random effects we used the specification
\begin{equation}
    \bm{\delta} = (\delta_{111}, \ldots, \delta_{nTK})^\top \sim \mathcal{N}(\mathbf{0}, (\tau_\delta \mathbf{R}^\star_\delta)^{-}),
\end{equation}
where $\mathbf{R}^\star_\delta$ is a Kronecker product of the relevant space, time and category structure matrices.
In particular, for each of the four models including spatio-temporal interactions, these matrices are
\begin{itemize}
\item
1x: No spatial or temporal structure (Type I) $\mathbf{R}^\star_\delta = \mathbf{I} \otimes \mathbf{I} \otimes \mathbf{I}$,
\item
2x: Structured spatial and unstructured temporal (Type II) $\mathbf{R}^\star_\delta = \mathbf{R}^\star_b \otimes \mathbf{I} \otimes \mathbf{I}$,
\item
3x: Unstructured spatial and structured temporal (Type III) $\mathbf{R}^\star_\delta = \mathbf{I} \otimes \mathbf{R}^\star_a \otimes \mathbf{I}$,
\item
4x: Structured spatial and temporal (Type IV) $\mathbf{R}^\star_\delta = \mathbf{R}^\star_b \otimes \mathbf{R}^\star_a \otimes \mathbf{I}$,
\\
\end{itemize}
where the first, second and third elements of the product represent space, time and category respectively, and the interaction type provided in brackets is given according to the @knorr2000bayesian framework.

### Survey weighted likelihood

<!-- To account for the complex survey design, in which individuals have unequal sampling probabilities, we replaced the observed counts $\{y_{itak}\}$ in each risk group with weighted counts $\{y_{itak}^\star\}$ and used a pseudo-likelihood to extend the Poisson distribution to non-integer weighted counts. -->

The surveys we used utilise a complex design, in which each individual has an unequal probability of being included in the sample.
For example, the DHS often employs a two-stage cluster design, first taking an urban rural stratified sample of ennumeration areas, before selecting households from each ennumeration area using systematic sampling.
To account for the survey design, we use a weighted pseudo-likelihood where the observed counts $y_{itak}$ are replaced by effective counts $y^\star_{itak}$ calculated using survey weights $w_{itak}$.
We multiplied direct estimates produced using the `survey` package \citep{JSSv009i08} by the Kish effective sample size \citep{kish1965survey}
\begin{equation}
    m^\star_{itak} = \left(\sum_{itak} w_{itak} \right)^2 / \sum_{itak} {w_{itak}}^2
\end{equation}
to obtain $y^\star_{itak}$.
As these counts may not be integers, the Poisson likelihood in Equation~\eqref{eq:poisson} is inappropriate.
Instead, we used a generalised Poisson pseudo-likelihood $y^\star \sim \text{xPoisson}(\kappa)$, as implemented by `family = "xPoisson"` in `R-INLA`, given by
\begin{equation}
    p(y^\star) = \frac{\kappa^{y^\star}}{\left \lfloor{y^\star!}\right \rfloor } \exp \left(- \kappa \right).
\end{equation}

\subsection{Logistic regression model} \label{app:logistic-model}

\begin{table}[htb]
\small
\centering
\begin{tabularx}{\textwidth}{llllll}
\midrule
Model ID & Intercept ($\beta_0$) & Age ($\alpha_a$) & Country ($\zeta_c$) & Spatial ($\phi_i$) & Covariates \\ 
\midrule
L1 & Constant & IID & IID & IID & None \\
L2 & Constant & IID & IID & Besag & None \\
L3 & Constant & IID & IID & IID & \texttt{cfswever} \\
L4 & Constant & IID & IID & Besag & \texttt{cfswever} \\
L5 & Constant & IID & IID & IID & \texttt{cfswrecent} \\
L6 & Constant & IID & IID & Besag & \texttt{cfswrecent} \\
\midrule
\end{tabularx}
\caption{The logistic regression models that were considered. \texttt{cfswever} denotes the proportion of men who have ever paid for sex and \texttt{cfswrecent} denotes the proportion of men who have paid for sex in the past 12 months \citep{hodgins2022population}.}
\label{tab:logistic-models}
\small
\end{table}

We considered six logistic regression models (Table~\ref{tab:logistic-models}) each including a constant $\beta_0 \sim \mathcal{N}(-2, 1^2)$, age random effects $\alpha_a \sim \mathcal{N}(0, \tau_\alpha^{-1})$ and country random effects $\zeta_c \sim \mathcal{N}(0, \tau_\zeta^{-1})$.
We considered two specifications (IID, Besag) for the spatial random effects $\phi_i$.
To aid estimation with sparse data, we also considered national-level covariates for the proportion of men who have paid for sex ever \texttt{cfswever} or in the last twelve months \texttt{cfswrecent}, available from \citet{hodgins2022population}.
For both random effect precision parameters $\tau \in \{\tau_\alpha, \tau_\zeta\}$ as before we use the PC prior with base model $\sigma = 0$ and $\mathbb{P}(\sigma > 2.5 = 0.01)$.
For the regression parameters $\beta \in \{\beta_\texttt{cfswever}, \beta_\texttt{cfswrecent}\}$ we used the prior $\beta \sim \mathcal{N}(0, 2.5^2)$.

\subsubsection{Survey weighted likelihood}

As with the multinomial regression model, we used survey weighted counts $\{y_{itak}^\star\}$ and sample sizes $\{m_{itak}^\star\}$.
We used a used a generalised binomial pseudo-likelihood $y^\star \sim \text{xBinomial}(y^\star, m^\star)$, as implemented by \texttt{family = "xBinomial"} in \texttt{R-INLA}, given by
\begin{equation}
    p(y^\star \, | \, m^\star) =  \binom{\lfloor m^\star \rfloor}{\lfloor y^\star \rfloor} q^{y^\star} (1 - q)^{m^\star - y^\star}.
\end{equation}
to extend the binomial distribution to non-integer weighted counts and sample sizes.

\subsubsection{Model selection}

\begin{footnotesize}

\begin{table}[h]
\centering
\begin{tabularx}{0.82\textwidth}{lllllll}
\toprule
 & Model 1 & Model 2 & Model 3 & Model 4 & Model 5 & Model 6 \\ 
\midrule
DIC & 4662 (110) & 4605 (111) & 4662 (110) & 4605 (111) & 4662 (110) & 4605 (111) \\ 
WAIC & 4692 (115) & 4624 (115) & 4692 (115) & 4624 (115) & 4692 (115) & 4624 (115) \\ 
CPO & 950 (15) & 969 (15) & 951 (15) & 970 (15) & 950 (15) & 970 (15) \\ 
\bottomrule
\end{tabularx}
\caption{Logistic regression model performance.}
\label{tab:logistic-model-performance}
\end{table}

\end{footnotesize}

\begin{figure}[h]
    \centering
    \makebox[\textwidth][c]{\includegraphics{figures/fsw-logit-information-criteria.pdf}}
    \caption{Logistic regression model performance.}
    \label{fig:logistic-model-performance}
\end{figure}

\newpage

# Prevalence, incidence and new infections reached analysis

## Calculation of prevalence and PLHIV

We calculated HIV prevalence $\rho_{iak}$ and number of people living with HIV (PLHIV) $H_{iak} = \rho_{iak} N_{iak}$ stratified according to district, age group and risk group by disaggregation
\begin{align}
    H_{ia} &= \sum_k H_{iak} = \sum_k \rho_{iak} N_{iak} \\
    &= \rho_{ia1} N_{ia1} + \rho_{ia1} \text{PR}_2 N_{ia2} + \rho_{ia1} \text{PR}_3 N_{ia3} + \rho_{ia1} \text{PR}_4 N_{ia4} \\
    &= \rho_{ia1} \left(N_{ia1} + \text{PR}_2 N_{ia2} + \text{PR}_3 N_{ia3} + \text{PR}_4 N_{ia4} \right).
\end{align}
Risk group specific prevalence estimates are then given by
\begin{align}
    \rho_{ia1} &= H_{ia} / \left(N_{ia1} + \text{PR}_2 N_{ia2} + \text{PR}_3 N_{ia3} + \text{PR}_4 N_{ia4} \right), \\
    \rho_{ia2} &= \rho_{ia1} \text{PR}_2,\\
    \rho_{ia3} &= \rho_{ia1} \text{PR}_3,\\
    \rho_{ia4} &= \rho_{ia1} \text{PR}_4,
\end{align}
which we evaluated using Naomi model estimates of PLHIV $H_{ia} = \rho_{ia} N_{ia}$, prevalence ratios $\{\text{PR}_k\}$ as described below, and risk group population sizes $N_{iak} = p_{iak} N_{ia}$ based on our 2018 risk group estimates together with population size estimates from the Naomi model.
To obtain the prevalence ratios, we...

## Calculation of incidence and number of new infections

Similarly, we calculated HIV incidence $\lambda_{iak}$ and number of new HIV infections $I_{iak}$ stratified according to district, age group and risk group by disaggregation
\begin{align}
    I_{ia} &= \sum_k I_{iak} = \sum_k \lambda_{iak}N_{iak} \\
    &= 0 + \lambda_{ia2} N_{ia2} + \lambda_{ia3} N_{ia3} + \lambda_{ia4} N_{ia4} \\
    &= \lambda_{ia2} \left(N_{ia2}  + \text{RR}_{3} N_{ia3} + \text{RR}_4(\lambda_{ia}) N_{ia4}  \right).
\end{align}
Risk group specific incidence estimates are then given by
\begin{align}
    \lambda_{ia1} &= 0, \\
    \lambda_{ia2} &= I_{ia} / \left(N_{ia2} + \text{RR}_{3} N_{ia3} + \text{RR}_4(\lambda_{ia}) N_{ia4}\right), \\
    \lambda_{ia3} &= \text{RR}_{3} \lambda_{ia2}, \\
    \lambda_{ia4} &= \text{RR}_4(\lambda_{ia}) \lambda_{ia2}.
\end{align}
which we evaluated using Naomi model estimates of the number of new HIV infections $I_{ia} = \lambda_{ia} N_{ia}$, HIV infection risk ratios $\{\text{RR}_3, \text{RR}_4(\lambda_{ia})\}$ as given in Table~\ref{tab:risk-categories}, and 2018 risk group population sizes as above.
The risk ratio $\text{RR}_4(\lambda_{ia})$ is defined as a function of general population incidence.
Using these estimates $\{\lambda_{iak}\}$, the number of new HIV infections is then $I_{iak} = \lambda_{iak} N_{iak}$.

## Analysis of new infections reached

We calculated the number of new infections that would be reached prioritising according to each possible stratification of the population.
As an illustration, for stratification by age, we aggregated the number of new HIV infections and HIV incidence as such 
\begin{align}
    I_a &= \sum_{ik} I_{iak}, \\
    \lambda_a &= I_a / \sum_{ik} N_{iak}.
\end{align}
Under this stratification, individuals in each age group $a$ would be prioritised according to the highest HIV incidence $\lambda_a$.
We repeated this analysis for all $2^3 = 8$ possible combinations of stratification by location, age, and risk group.

\newpage

# The Global AIDS Strategy 2021-2016

\begin{footnotesize}

\begin{table}[h]
\centering
\begin{tabularx}{\textwidth}{lX}
\toprule
Prioritisation strata & Criterion \\ 
 \midrule
Low & 0.3-1\% incidence AND low-risk behaviour OR $<$0.3\% incidence AND high-risk behaviour \\
Moderate & 1-3\% incidence AND low-risk behaviour OR 0.3-1\% incidence AND high-risk behaviour \\
High & 1-3\% incidence AND high-risk behaviour \\
Very high & $>$3\% incidence \\
\bottomrule
\end{tabularx}
\caption{Prioritisation strata.}
\label{tab:unaids-strategy-prioritisation}
\end{table}

\end{footnotesize}

\begin{footnotesize}

\begin{table}[h]
\centering
\begin{tabularx}{\textwidth}{lX}
\toprule
Intervention & Details \\ 
 \midrule
STI screening and treatment & (Remain to be filled in: describe targets and commitments in terms of each prioritisation strata) \\
PrEP use & (As above) \\
Access to PEP & (As above) \\
Comprehensive sexuality education & (As above) \\
Economic empowerment & (As above) \\
\bottomrule
\end{tabularx}
\caption{Targets and commitments.}
\label{tab:unaids-strategy-targets}
\end{table}

\end{footnotesize}

\newpage

# Survey questions and risk group classification

## Survey questions

\begin{footnotesize}

\begin{table}[h]
\centering
\begin{tabularx}{\textwidth}{lX}
\toprule
Variable(s) & Description \\ 
 \midrule
\texttt{v501} & Current marital status of the respondent. \\
\texttt{v529} & Computed time since last sexual intercourse. \\
\texttt{v531} & Age at first sexual intercourse--imputed. \\
\texttt{v766b} & Number of sexual partners during the last 12 months (including husband). \\
\texttt{v767[a, b, c]} & Relationship with last three sexual partners. Options are: spouse, boyfriend not living with respondent, other friend, casual acquaintance, relative, commercial sex worker, live-in partner, other. \\
\texttt{v791a} & Had sex in return for gifts, cash or anything else in the past 12 months. Asked only to women 15-24 who are not in a union. \\
\bottomrule
\end{tabularx}
\caption{AIS, BAIS and DHS survey questions.}
\end{table}

\end{footnotesize}

\begin{footnotesize}

\begin{table}[h]
\centering
\begin{tabularx}{\textwidth}{lX}
\toprule
Variable(s) & Description \\ 
 \midrule
\texttt{part12monum} & Number of sexual partners during the last 12 months (including husband). \\
\texttt{part12modkr} & Reason for leaving \texttt{part12monum} blank. \\
\texttt{partlivew[1, 2, 3]} & Does the person you had sex with live in this household? \\
\texttt{partrelation[1, 2, 3]} & Relationship with last three sexual partners. Options are: husband, live-in partner, partner (not living with), ex-spouse/partner, friend/acquaintance, sex worker, sex worker client, stranger, other, don't know, refused. \\
\texttt{sellsx12mo} & Had sex for money and/or gifts in the last 12 months. \\
\texttt{buysx12mo} & Paid money or given gifts for sex in the last 12 months. \\
\bottomrule
\end{tabularx}
\caption{PHIA survey questions.}
\end{table}

\end{footnotesize}

\newpage

\subsection{Risk group classification based on survey questions}

\begin{figure}[h!]
    \centering
    \includegraphics{depends/category-flowchart.pdf}
    \caption{Flowchart describing allocation of respondents to risk groups.}
    \label{fig:category-flowchart}
\end{figure}

\newpage

# Supplementary figures

\newpage

# Supplementary tables

\newpage

# References {#references .unnumbered}
