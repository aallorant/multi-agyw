---
title: Spatio-temporal estimates of HIV risk group proportions for adolescent girls and young women across 13 priority countries in sub-Saharan Africa
author:
  - name: Adam Howes
    email: ath19@ic.ac.uk
    affiliation: [A, B]
    corresponding: ath19@ic.ac.uk
  - name: Kathryn A. Risher 
    affiliation: [C, B]
  - name: Van KÃ­nh Nguyen
    affiliation: B
  - name: Oliver Stevens
    affiliation: B
  - name: Katherine M. Jia
    affiliation: D
  - name: Timothy M. Wolock
    affiliation: [A, B]
  - name: Lycias Zembe
    affiliation: E
  - name: Ian Wanyeki
    affiliation: E
  - name:  Mary Mahy
    affiliation: E
  - name: Clemens Benedikt
    affiliation: E
  - name: Seth R. Flaxman
    affiliation: F
  - name: Jeff W. Eaton
    affiliation: B
address:
  - code: A
    address: Department of Mathematics, Imperial College London
  - code: B
    address: MRC Centre for Global Infectious Disease Analysis, School of Public Health, Imperial College London
  - code: C
    address: Department of Medical Social Sciences, Feinberg School of Medicine, Northwestern University
  - code: D
    address: Harvard T. H. Chan School of Public Health, Harvard University
  - code: E
    address: Joint United Nations Programme on HIV/AIDS, Geneva, Switzerland
  - code: F
    address: Department of Computer Science, University of Oxford
abstract: |
  **Background:**
  The Global AIDS Strategy 2021-2026 identifies adolescent girls and young women (AGYW) as a priority population for HIV prevention, and recommends differentiating intervention portfolios geographically based on local HIV incidence and individual risk behaviours.
  We aimed to estimate occurance of HIV risk behaviours and associated HIV incidence at a small spatial scale among AGYW living in 13 countries in sub-Saharan Africa.

  **Methods:**
  We analysed 47 geospatially referenced national household surveys conducted between 1999-2018 across 13 Global   Fund priority countries in sub-Saharan Africa.
  Female survey respondents aged 15-29 years were classified into four risk groups (not sexually active, cohabiting, non-regular partner[s] and female sex workers) based on reported sexual behaviour.
  We used a Bayesian spatio-temporal multinomial regression model to estimate the proportion of AGYW in each risk group stratified by district, year, and five-year age group.
  Using the UNAIDS Naomi modelled district-level estimates of HIV prevalence and incidence, we then estimated new HIV infections and incidence in each risk group and assessed the efficiency of prioritising interventions according to risk group.

  **Results:**
  Data consisted of `r "num"` female survey respondents aged 15-29.
  Risk group proportions varied substantially across age groups (`r "num"`\% of variation), countries (`r "num"`\%), and between districts within each country (`r "num"`\%), but changed little over time (`r "num"`\%).
  Among women aged 20-29, we found a geographic delineation, north of which, in eastern Africa, cohabiting (`r "num"`\%) is more common than non-regular partner(s) (`r "num"`\%), and south of which, non-regular partner(s) (`r "num"`\%) are more common than cohabiting (`r "num"`\%).
  Prioritisation based on behavioural risk, in combination with location- and age-based prioritisation, reduced the proportion of population that must be reached to find half of all new infections from `r "num"`\% to `r "num"`\%.
  Female sex workers were `r "num"`\% of the at risk population but `r "num"`\% of all new infections.

  **Conclusions:**
  Our risk group estimates provide data for HIV programmes to implement a differentiated prevention approach and set targets according to the Global AIDS Strategy.
  Successfully implementing this approach would result in finding substantially more infections, particularly among female sex workers.
author_summary: |
  The risk HIV poses to adolescent girls and young women depends on individual sexual behaviour as well as the extent of HIV in the local community.
  The same sexual behaviour is more or less likely to result in HIV acquisiton depending on the scale of the epidemic in the community.
  To help policy makers identify and provide services to those at highest risk, we geographically mapped HIV risk groups using behavioural data from household surveys.
  Doing so also allowed us to estimate the the proportion of people living with HIV in each risk group, as well as the rate of new infections in each risk group.
bibliography: citations.bib
output:
  rticles::plos_article:
    includes:
      in_header: preamble.tex
# plos.csl can be download and used locally
csl: http://www.zotero.org/styles/plos
---

```{r echo = FALSE}
options(scipen = 100)

knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  dpi = 320,
  cache = TRUE,
  out.width = "95%",
  fig.align = 'center'
)
```

```{r}
library(tidyverse)

priority_iso3 <- multi.utils::priority_iso3()
analysis_level <- multi.utils::analysis_level()
admin1_level <- multi.utils::admin1_level()

hiv_estimates <- readxl::read_excel(
  "HIV2021Estimates_Global_PLWHV-NI-Pop_6June2022.xlsx", 
  sheet = "Table"
) %>%
  filter(ISO3 %in% priority_iso3) %>%
  select(-c(`...1`, "UN", "ISO2", `...5`, "Region"))

population_comparison <- hiv_estimates %>%
  select(
    "ISO3",
    "L- Population by age and sex 15-19 ; Female", 
    "L- Population by age and sex 20-24 ; Female", 
    "L- Population by age and sex 25-29 ; Female",
    "L- Population aged 15-49 Male+Female"
  ) %>%
  mutate(pop_female_Y015_029 = `L- Population by age and sex 15-19 ; Female` +
    `L- Population by age and sex 20-24 ; Female` + 
    `L- Population by age and sex 25-29 ; Female`
  ) %>%
  summarise(
    total = sum(`L- Population aged 15-49 Male+Female`),
    subset = sum(pop_female_Y015_029)
  )

population_percent <- 100 * round(population_comparison$subset / population_comparison$total, digits = 2)

infections_comparison <- hiv_estimates %>%
  select(
    "ISO3",
    "L- New infections by age 15-19 ; Female", 
    "L- New infections by age 20-24 ; Female", 
    "L- New infections by age 25-29 ; Female",
    "L- New HIV infections (15-49) Male+Female"
  ) %>%
  mutate(inf_female_Y015_029 = `L- New infections by age 15-19 ; Female` +
    `L- New infections by age 20-24 ; Female` + 
    `L- New infections by age 25-29 ; Female`
  ) %>%
  summarise(
    total = sum(`L- New HIV infections (15-49) Male+Female`),
    subset = sum(inf_female_Y015_029)
  )

infections_percent <- 100 * round(infections_comparison$subset / infections_comparison$total, digits = 2)

inc_comparison <- hiv_estimates %>%
  select(
    "ISO3",
    "L- New infections by age 15-19 ; Female", 
    "L- New infections by age 20-24 ; Female", 
    "L- New infections by age 25-29 ; Female",
    "L- New infections by age 15-19 ; Male", 
    "L- New infections by age 20-24 ; Male", 
    "L- New infections by age 25-29 ; Male",
    "L- Population by age and sex 15-19 ; Female", 
    "L- Population by age and sex 20-24 ; Female", 
    "L- Population by age and sex 25-29 ; Female",
    "L- Population by age and sex 15-19 ; Male", 
    "L- Population by age and sex 20-24 ; Male", 
    "L- Population by age and sex 25-29 ; Male",
  ) %>%
  mutate(
    inf_female_Y015_029 = `L- New infections by age 15-19 ; Female` +
    `L- New infections by age 20-24 ; Female` + 
    `L- New infections by age 25-29 ; Female`,
    inf_male_Y015_029 = `L- New infections by age 15-19 ; Male` +
    `L- New infections by age 20-24 ; Male` + 
    `L- New infections by age 25-29 ; Male`,
    pop_female_Y015_029 = `L- Population by age and sex 15-19 ; Female` +
    `L- Population by age and sex 20-24 ; Female` + 
    `L- Population by age and sex 25-29 ; Female`,
    pop_male_Y015_029 = `L- Population by age and sex 15-19 ; Male` +
    `L- Population by age and sex 20-24 ; Male` + 
    `L- Population by age and sex 25-29 ; Male`
  ) %>%
  summarise(
    inc_female_Y015_029 = sum(inf_female_Y015_029) / sum(pop_female_Y015_029),
    inc_male_Y015_029 = sum(inf_male_Y015_029) / sum(pop_male_Y015_029)
  )

inc_ratio <- round(inc_comparison$inc_female_Y015_029 / inc_comparison$inc_male_Y015_029, digits = 1)
```

# Introduction

In sub-Saharan Africa, adolescent girls and young women (AGYW) aged 15-29 are `r population_percent`\% of the population but `r infections_percent`\% of new HIV infections [@unaids2021update].
HIV incidence amongst AGYW is `r inc_ratio` times higher than among similarly aged males due to younger age at first sex, age patterns of sexual mixing, structural vulnerability and power imbalances, and increased susceptibility to HIV infection [@joint2016hiv].
AGYW have therefore been identified as a priority population for HIV primary prevention, with significant investments being been made in prevention programming [@saul2018dreams; @global2018measurement].

HIV prevention for AGYW is typically comprised of: (1) basic programming which is made available to all (2) more intensified programming which is differentiated on the basis of risk [@joint2016hiv; @birdthistle2018evaluating].
To maximize the impact of intensified programming delivery should be prioritised towards those at the highest risk level.
As both community-level epidemic indicators and individual-level behaviours determine risk of acquiring HIV, it is important to consider both of these factors in tandem to enable more efficient prioritisation of prevention services [@anderson2014maximising; @mcgillen2016optimum; @kelly2018global; @jia2022risk].

The Global AIDS Strategy 2021-2016 [@unaids2021global], adopted by the UN General Assembly in June 2021, proposed stratifying provision of HIV prevention to AGYW based on both local population-level HIV incidence and individual-level sexual risk behaviour.
Four prioritisation strata (Table) are defined based on: (1) subnational annual incidence (<0.3\%, 0.3-1\% and >3\%), and (2) self-reported high-risk behaviour or recent STI infection.
The strategy encourages programmes to  define targets for the proportion of AGYW to be reached with a range of interventions (Table) based upon this prioritisation strata [@unaids2021global].
These interventions may include STI screening and treatment, access to pre-exposure prophylaxis (PrEP), access to post-exposure prophylaxis (PEP), comprehensive sexuality education, and economic empowerment.

Implementation of the strategy by national HIV programmes and stakeholders requires data on the population size and HIV incidence in each risk group by location to determine prioritisation for stratified HIV prevention.
We developed a multivariate Bayesian spatio-temporal model to estimate the proportion of AGYW aged 15-29 years in four behavioural risk groups, stratified by district, year, and five-year age group.
We focused on 13 countries in sub-Saharan Africa which have been identified by by the Global Fund to Fight AIDS, TB, and Malaria [@global2018measurement] as priority countries for implementation of AGYW HIV prevention.
Our methodology is standardised across countries, allowing prioritisation both within and between countries.
We analysed the extent to which the risk group proportions varied across districts, age groups, between countries, and over time.
Using our estimates, we calculated the HIV prevalence, people living with HIV (PLHIV), HIV incidence, and number of new HIV infections in each risk group by disaggregating district-level estimates from the Naomi model [@eaton2021naomi].
Finally, we quantified the increased efficiency of HIV prevention, in terms of the expected number of new infections that could be preemptively reached, by stratified prioritisation of interventions.

# Methodology

\begin{table}[htb]
\small
\centering
\begin{tabularx}{\textwidth}{llX}
\toprule
Risk group & Description & Risk ratio \\
\midrule
None & Not sexually active & 0 \\
Low & One cohabiting sexual partner & 1 \\
High & Non-regular sexual partner(s) & 1.72 \\
Very high & Female sex workers & {
\begin{tabularx}{\linewidth}{ll}
District-level HIV incidence & Risk ratio\\
$>$3.0\% & 3 \\
1.0-3.0\% & 6 \\
0.3-1.0\% & 9 \\
0.1-0.3\% & 13 \\
$<$0.1\% & 25 \\
\end{tabularx}
} \\
\bottomrule
\end{tabularx}
\caption{HIV risk groups and incidence risk ratios giving the ratio of probabilities of being sexually infected with HIV in the next year relative to the baseline group.}
\label{tab:risk-groups}
\small
\end{table}

## Data

We analysed nationally-representative household survey data from 13 countries: Botswana, Cameroon, Kenya, Lesotho, Malawi, Mozambique, Namibia, South Africa, Eswatini, Tanzania, Uganda, Zambia and Zimbabwe.
We included surveys conducted in these countries in the years 1999-2018 in which women were interviewed about their sexual behaviour and sufficient geographic information was available to locate survey clusters to districts.
Demographic and Health Surveys (DHS), AIDS Indicator Surveys (AIS), Population-based HIV Impact Assessment (PHIA) surveys, and the Botswana HIV/AIDS Impact Survey 2013 (BAIS) were included.

For each survey, we classified respondents into one of four behavioural risk groups according to reported sexual risk behaviour in the past 12 months.
These risk groups were: not sexually active, one cohabiting sexual partner, at least one non-regular sexual partner, and AGYW who are female sex workers (FSW) (Table \ref{tab:risk-groups}).
In the case of inconsistent responses, women were categorised according to the highest risk group they fell into, ensuring that the categories were mutually exclusive.
Exact survey questions varied to a limited extent between surveys (Appendix B).
Questions captured information about if the respondent had been sexually active in the past twelve months, and if so how with many partners.
For their three most recent partners, respondents were also asked about the type of partnership (spouse, cohabiting partner, partner not cohabiting with respondent, friend, sex worker, sex work client, and other).

Some surveys included a specific question asking if the respondent had received or given payment for sex in the past twelve months; in these surveys, 2.64\% of women reported transactional sex.
In surveys without that question, women almost never (0.01\%) answered that one of their three most recent partners was a sex work client.
For this reason, we did not include surveys without a specific transactional sex question when estimating the proportion of the population who were FSW or engaged in transactional sex.

We used estimates of population, people living with HIV (PLHIV) and new HIV infections stratified by district and age group from outputs of the Naomi model [@eaton2021naomi].
The model synthesises data from multiple sources to produce consistent subnational estimates of indicators of interest, and has been used by countries as a part of the HIV estimates process supported by UNAIDS.
The administrative area hierarchy and geographic boundaries we used correspond to those used in Naomi, with the exception of Cameroon and Kenya where we used an analysis level one higher (Appendix B).

## Two-stage risk group proportion model

To estimate the proportion of AGYW in each risk group we took a two-stage modelling approach, further details of which are provided in Appendix.
First, we fit a spatio-temporal multinomial model stratified by district, year (1999-2018) and five-year age group (15-19, 20-24 and 25-29) for the proportion of AGYW in three categories: (1) not sexually active, (2) cohabiting, and (3) either non-regular partner(s) or transactional sex.
Combining the two highest risk groups in this way allowed data from all 47 surveys to be included in this first stage model.
Second, we fit a spatial logistic regression model separating those who have non-regular parnter(s) from those who have had transactional sex, stratified by district, and five-year age group, and using only data from the 13 surveys with a specific transaction sex question.
As these surveys were only available in the years 2013-2018, we assumed the proportion in the very high risk group among those in at least the high risk group was constant over time.
We combined the two models using 1000 samples from each posterior distribution to produce samples from all four risk groups.
Finally, we adjusted the samples from the transactional sex category to match age-country specific FSW population size estimates, modifying the samples from the non-regular partner(s) category such that the proportions sum to one.
To do so, we disaggregated national 15-49 FSW population size estimates from @stevens2022estimating using the FSW age distribution in South Africa from the Thembisa model [@johnson2020thembisa] in combination with country-specific age at first sex distributions from @kinh2021trends.

<!-- \text{Gamma}(\alpha = 10.4, \beta = 0.36)$ FSW age distribution -->

We considered eight model specifications for the space-age-time multinomial model for the three risk groups (Appendix A).
All models included intercepts for each risk group, age, country, and age-country effects, a spatial effect allowing variation by district, and a temporal effect allowing variation over time.
Alternative models varied the specification for the spatial effect between independent spatial effects versus spatially correlated effects and independent temporal effects versus first-order auto-regressive temporal effects.
Each alternative was considered with an additional spatio-temporal interaction term allowing the temporal trend to vary across districts.
To understand the importance of each part of the model we undertook a variance-based sensitivity analysis using the random effect variance parameters.

For the logistic regression model for the proportion engaging in transactional sex among those with non-regular partner(s), we considered six specifications (Appendix A).
Each included an intercept, age and country effects, and a spatial effect allowing district level variation.
Both independent and spatially correlated spatial effects were considered.
To improve estimation with sparse data, we considered model alternatives with national-level covariates for either the proportion of men who reported ever having paid for sex or having paid for sex in the last twelve months, available from @hodgins2022population.

We performed inference using integrated nested Laplace approximation [@rue2009approximate] via the `R-INLA` package [@martins2013bayesian].
The best performing model was selected according to the conditional predictive ordinate (CPO) criteria, a measure of leave-one-out model performance that can be calculated directly in `R-INLA` without explicit model refitting [@held2010posterior].
The \textsc{R} [@r] code used to implement the models and produce  results is available from `github.com/athowes/multi-agyw`.
We used the `orderly` package [@orderly] for reproducible research.

## HIV indicators and prevention prioritisation

We used the risk group proportion estimates to calculate HIV prevalence, PLHIV, HIV incidence and number of new HIV infections stratified according to district, age group and risk group by disaggregating estimates from the Naomi model.
Further details are provided in Appendix A.

### Prevalence and PLHIV

To calculate HIV prevalence by risk group we disaggregated on the logit scale using age-country prevalence log-odds ratios calculated from survey bio-marker data. 
Logit scaling was used because linear scaling resulted in some strata having prevalence above 100\%.
PLHIV were calculated by multiplying HIV prevalence by risk group population size.

### Incidence and new infection

We disaggregated HIV incidence by risk group linearly using the HIV infection risk ratios given in Table \ref{tab:risk-groups}.
The risk ratio used for the not sexually active risk group was zero, reflecting exclusion of incidence from non-sexual transmission, e.g. unsafe injection, which is negligible in these populations.
For the non-regular partner(s) risk group, the risk ratio was based upon analyses of risk factors for incident HIV infection from studies in sub-Saharan Africa by @slaymaker2020croi and supported by the review of @jia2022risk.
Risk ratios for the highest risk group vary based upon general population HIV incidence and are based upon a UNAIDS analysis led by Keith Sabin.
Number of new HIV infections were calculated by multiplying HIV incidence by susceptible risk group population size.

### Infections reached

For each possible stratification of risk, we calculated the number of new infections that would be found per person reached when prioritising according to incidence.
We assumed all members of every strata can be reached.

# Results

## Data

```{r fig.cap="Surveys used in our analysis by year, survey type, sample size, and whether the survey included a transactional sex question. \\label{fig:available-surveys}"}
knitr::include_graphics("depends/available-surveys.pdf")
```

```{r results='hide', warning=FALSE, message=FALSE}
available_surveys <- read_csv("depends/available-surveys.csv")

#' What was the total number of surveys?
total_surveys <- available_surveys %>%
  pull(survey_id) %>%
  unique() %>%
  length()

#' How many AGYW, in total, were surveyed?
agyw_surveyd <- available_surveys %>%
  pull(Y015_029) %>%
  sum()

#' What about disaggregating these AGYW by age?
agyw_surveyed_age <- available_surveys %>%
  summarise(
    Y015_019 = sum(Y015_019),
    Y020_024 = sum(Y020_024),
    Y025_029 = sum(Y025_029)
  )

#' What was the total number of surveys including a transactional question?
giftsvar_surveys <- available_surveys %>%
  filter(giftsvar == 1) %>%
  pull(survey_id)

length(giftsvar_surveys)

#' How many AGYW were sampled in these surveys?
agyw_surveyed_giftsvar <- available_surveys %>%
  filter(survey_id %in% giftsvar_surveys) %>%
  pull(Y015_029) %>%
  sum()

#' Disaggregated by age
#' TODO: This isn't quite right because some 25-29 are not asked FSW question in DHS surveys
agyw_surveyed_giftsvar_age <- available_surveys %>%
  filter(survey_id %in% giftsvar_surveys) %>%
  summarise(
    Y015_019 = sum(Y015_019),
    Y020_024 = sum(Y020_024),
    Y025_029 = sum(Y025_029)
  )

#' What was the median number of surveys by country, and the range?
number_of_surveys <- available_surveys %>%
  group_by(iso3) %>%
  summarise(
    count = length(unique(survey_id))
  )

number_of_surveys %>%
  summarise(
    min = min(count),
    median = median(count),
    max = max(count)
  )
```

We included `r total_surveys` surveys in our analysis (Fig \ref{fig:available-surveys}, Table), with a total sample size of `r agyw_surveyd` women aged 15-29 years (`r agyw_surveyed_age$Y015_019` aged 15-19 years, `r agyw_surveyed_age$Y020_024` aged 20-24 years, and `r agyw_surveyed_age$Y025_029` aged 25-29 years).
Of these, `r length(giftsvar_surveys)` surveys included a specific transactional sex question, with a total sample size in these surveys of `r agyw_surveyed_giftsvar` (`r agyw_surveyed_giftsvar_age$Y015_019` aged 15-19 years, `r agyw_surveyed_giftsvar_age$Y020_024` aged 20-24 years, and `r agyw_surveyed_giftsvar_age$Y025_029` aged 25-29 years).
The median number of surveys per country was four, ranging from one in Botswana and South Africa to six in Uganda.

## Model selection

The best fitting multinomial regression model included correlated spatial effects and first-order autoregressive temporal effects, but not spatio-temporal interactions.
The best logistic regression model for transactional sex included correlated spatial effects and the proportion of men who reported ever paying for sex covariate.
Model performance according to the CPO criteria is provided in Appendix A for all considered models.

## Risk group estimates

```{r continental-map, fig.cap="Choropleths of the posterior mean proportion of AGYW in each risk group in 2018. Countries in grey are included to show Cameroon (upper left) in relation to the other twelve spatially-contiguous countries (lower right). \\label{fig:continental-map}"}
knitr::include_graphics("depends/3p1-continental-map.png")
```

```{r within-between-country-variation, fig.cap="National (in white) and subnational (in color) posterior means of the risk group proportions. We used regions of sub-Saharan Africa defined according to the UN geocode (M49). \\label{fig:within-between-country-variation}"}
knitr::include_graphics("depends/3p1-within-between-country-variation.pdf")
```

Posterior mean estimates from our final model are shown as choropleths (Fig \ref{fig:continental-map}) and dotplots (Fig \ref{fig:within-between-country-variation}).
Direct estimates of the four risk group proportions from these surveys were highly correlated with our modelled estimates at a national-level.
Posterior mean, median, upper (97.5\%) and lower (2.5\%) credible estimates for each district, age group and year from our final model are provided in the supplementary material.
In the writing to follow, all estimates refer to 2018, the most recent year included in our analysis, unless otherwise indicated.

```{r results=FALSE}
df_3p1_subnational <- read_csv("depends/df_3p1_subnational.csv")
df_3p1_national <- read_csv("depends/df_3p1_national.csv")

#' Quantification of points discussed
#' District level quantile information (age disaggregated)
district_age_quantiles <- df_3p1_subnational %>%
  select(iso3, indicator, age_group, estimate_smoothed) %>%
  group_by(indicator, age_group) %>%
  summarise(
    lower = 100 * quantile(estimate_smoothed, probs = 0.025, na.rm = TRUE),
    median = 100 * median(estimate_smoothed, na.rm = TRUE),
    upper = 100 * quantile(estimate_smoothed, probs = 0.975, na.rm = TRUE)
  )

district_Y015_019_nosex12m_quantiles <- filter(district_age_quantiles, indicator == "No sex", age_group == "15-19")

#' District level quantile information aggregated by age (population weighted)
district_quantiles <- df_3p1_subnational %>%
  select(iso3, area_id, indicator, age_group, estimate_smoothed, population_mean) %>%
  group_by(area_id, indicator) %>%
  summarise(
    estimate_smoothed = sum(estimate_smoothed * population_mean) / sum(population_mean)
  ) %>%
  ungroup() %>%
  group_by(indicator) %>%
  summarise(
    lower = 100 * quantile(estimate_smoothed, probs = 0.025, na.rm = TRUE),
    median = 100 * median(estimate_smoothed, na.rm = TRUE),
    upper = 100 * quantile(estimate_smoothed, probs = 0.975, na.rm = TRUE)
  )

#' What proportion of 15-19 year-olds are cohabiting (or other indicators) in MOZ?
moz_Y015_019 <- df_3p1_national %>%
  filter(
    age_group == "15-19",
    iso3 == "Mozambique"
  ) %>%
  mutate(estimate_smoothed = 100 * estimate_smoothed)

moz_Y015_019_nosex12m <- filter(moz_Y015_019, indicator == "No sex")
moz_Y015_019_sexcohab <- filter(moz_Y015_019, indicator == "Cohabiting partner")
moz_Y015_019_sexnonreg <- filter(moz_Y015_019, indicator == "Non regular partner(s)")

#' In which countries are the majority of 15-19 year-olds not sexually active?
#' (Just MOZ!)
majority_claim_moz <- df_3p1_national %>%
  filter(
    age_group == "15-19",
    indicator == "No sex"
  ) %>%
  mutate(estimate_smoothed = 100 * estimate_smoothed) %>%
  filter(estimate_smoothed < 50)
 
#' What proportion of 20-29 year-olds are cohabiting versus with nonregular partner(s),
#' above and below the south / east dividing border (UN geoscheme)?
dividing_border <- df_3p1_subnational %>%
  mutate(
    border = ifelse(region %in% c("Eastern", "Central"), "Above", "Below")
  ) %>%
  select(iso3, area_id, indicator, age_group, border, estimate_smoothed, population_mean) %>%
  filter(
    indicator %in% c("Cohabiting partner", "Nonregular partner(s)"),
    age_group %in% c("20-24", "25-29")
  ) %>%
  group_by(area_id, indicator) %>%
  summarise(
    estimate_smoothed = sum(estimate_smoothed * population_mean) / sum(population_mean),
    border = max(border) #' Should just be a way to keep border column
  ) %>%
  ungroup() %>%
  group_by(border, indicator) %>%
  summarise(
    lower = 100 * quantile(estimate_smoothed, probs = 0.025, na.rm = TRUE),
    median = 100 * median(estimate_smoothed, na.rm = TRUE),
    upper = 100 * quantile(estimate_smoothed, probs = 0.975, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  mutate(across(lower:upper, ~signif(.x, digits = 3)))

dividing_border_above_sexcohab <- filter(dividing_border, border == "Above", indicator == "Cohabiting partner")
dividing_border_above_sexnonreg <- filter(dividing_border, border == "Above", indicator == "Nonregular partner(s)")
dividing_border_below_sexcohab <- filter(dividing_border, border == "Below", indicator == "Cohabiting partner")
dividing_border_below_sexnonreg <- filter(dividing_border, border == "Below", indicator == "Nonregular partner(s)")

#' What's the average FSW proportion by age?
fsw_age <- df_3p1_subnational %>%
  filter(indicator == "FSW") %>%
  group_by(iso3, age_group) %>%
  summarise(estimate_smoothed = sum(estimate_smoothed * population_mean, na.rm = TRUE) / sum(population_mean, na.rm = TRUE)) %>%
  group_by(age_group) %>%
  summarise(
    lower = 100 * quantile(estimate_smoothed, probs = 0.025, na.rm = TRUE),
    median = 100 * median(estimate_smoothed, na.rm = TRUE),
    upper = 100 * quantile(estimate_smoothed, probs = 0.975, na.rm = TRUE)
  ) %>%
  mutate(across(lower:upper, ~signif(.x, digits = 3)))

fsw_age_Y015_019 <- filter(fsw_age, age_group == "15-19")
fsw_age_Y020_024 <- filter(fsw_age, age_group == "20-24")
fsw_age_Y025_029 <- filter(fsw_age, age_group == "25-29")

#' What about by country?
fsw_iso3 <- df_3p1_subnational %>%
  filter(indicator == "FSW") %>%
  group_by(iso3) %>%
  summarise(estimate_smoothed = sum(estimate_smoothed * population_mean, na.rm = TRUE) / sum(population_mean, na.rm = TRUE))
```

The median proportion of FSW nationally was `r fsw_age_Y015_019$median`\% (95\% CI `r fsw_age_Y015_019$lower`--`r fsw_age_Y015_019$upper`\%) for the 15-19 age group, `r fsw_age_Y020_024$median`\% (95\% CI `r fsw_age_Y020_024$lower`--`r fsw_age_Y020_024$upper`\%) for the 20-24 age group and `r fsw_age_Y025_029$median`\% (95\% CI `r fsw_age_Y025_029$lower`--`r fsw_age_Y025_029$upper`\%) for the 25-29 age group.

In the 20-24 and 25-29 year age groups, the majority of women were either cohabiting or had non-regular partner(s).
Countries in eastern and central Africa (Cameroon, Kenya, Malawi, Mozambique, Tanzania, Uganda, Zambia and Zimbabwe) had a higher proportion of women in these age groups cohabiting (`r dividing_border_above_sexcohab$median`\% [95\% CI `r dividing_border_above_sexcohab$lower`--`r dividing_border_above_sexcohab$upper`\%] as compared with `r dividing_border_above_sexnonreg$median`\% [95\% CI `r dividing_border_above_sexnonreg$lower`--`r dividing_border_above_sexnonreg$upper`\%] with non-regular partner[s]) and countries in southern Africa (Botswana, Eswatini, Lesotho, Namibia and South Africa) had a higher proportion with non-regular partner(s) (`r dividing_border_below_sexnonreg$median`\% [95\% CI `r dividing_border_below_sexnonreg$lower`--`r dividing_border_below_sexnonreg$upper`\%], as compared with `r dividing_border_below_sexcohab$median`\% [95\% CI `r dividing_border_below_sexcohab$lower`--`r dividing_border_below_sexcohab$upper`\%] cohabiting).
This clear geographic delineation passes along the border of Mozambique, through the interior of Zimbabwe and along the border of Zambia (Fig \ref{fig:continental-map}).

In most districts (`r round(district_Y015_019_nosex12m_quantiles$median, 1)`\%; 95\% credible interval [CI] `r round(district_Y015_019_nosex12m_quantiles$lower, 1)`--`r round(district_Y015_019_nosex12m_quantiles$upper, 1)`\%) adolescent girls aged 15-19 were not sexually active.
The exception was Mozambique, where the majority (`r 100 - round(moz_Y015_019_nosex12m$estimate_smoothed, 2)`\%) were sexually active in the past year and close to a third (`r round(moz_Y015_019_sexcohab$estimate_smoothed, 2)`\%) were cohabiting with a partner.

```{r}
variance_proportions <- read_csv("depends/variance-proportions-uncertainty.csv")
variance_proportions_age <- 100 * filter(variance_proportions, variable == "age") %>% select(-variable) %>% round(digits = 3)
variance_proportions_iso3 <- 100 * filter(variance_proportions, variable == "iso3") %>% select(-variable) %>% round(digits = 3)
variance_proportions_area <- 100 * filter(variance_proportions, variable == "area") %>% select(-variable) %>% round(digits = 3)
variance_proportions_year <- 100 * filter(variance_proportions, variable == "year") %>% select(-variable) %>% round(digits = 3)
variance_proportions_cat <- 100 * filter(variance_proportions, variable == "cat") %>% select(-variable) %>% round(digits = 3)
```

Age explained `r variance_proportions_age$mean`\% (95\% CI `r variance_proportions_age$lower`--`r variance_proportions_age$upper`\%) of the variation in risk group proportions.
Variance explained by location may be broken down into `r variance_proportions_iso3$mean`\% (95\% CI `r variance_proportions_iso3$lower`--`r variance_proportions_iso3$upper`\%) explained by country and `r variance_proportions_area$mean`\% (95\% CI `r variance_proportions_area$lower`--`r variance_proportions_area$upper`\%) explained by district.
The temporal effects only explained `r variance_proportions_year$mean`\% (95\% CI `r variance_proportions_year$lower`--`r variance_proportions_year$upper`\%) of variation, indicating very little change in risk group proportions over time.
We observed similar variance decomposition results fitting each country individually, and using other model specifications.

<!-- Write another paragraph here calling out some examples of the amount of variation -->
<!-- Awaiting additional results: https://github.com/athowes/multi-agyw/issues/95 -->

## Infections reached

```{r fig.cap="Percentage of new infections reached across all 13 countries, taking a variety of risk stratification approaches, against the percentage of at risk population reached. \\label{fig:infections-reached}"}
knitr::include_graphics("depends/infections-reached.pdf")
```

```{r results=FALSE}
inf <- read_csv("depends/infections-reached.csv")
inf_country <- readRDS("depends/infections-reached-country.rds")

#' What is the minimum proportion of the population to reach in order to
#' achieve reaching over q \in [0, 1] proportion of the new infections?
min_pop_reached <- function(inf, q) {
  inf %>%
    filter(prop_infections_averted_cumulative > q) %>%
    group_by(stratification) %>%
    filter(prop_population_cumulative == min(prop_population_cumulative)) %>%
    select(stratification, prop_infections_averted_cumulative, prop_population_cumulative)
}

inf_quarter <- min_pop_reached(inf, 0.25)
inf_half <- min_pop_reached(inf, 0.5)

inf_half_with_behaviour <- round(100 * filter(inf_half, stratification == "Area, age, behaviour")$prop_population_cumulative, 1)
inf_half_without_behaviour <- round(100 * filter(inf_half, stratification == "Area, age")$prop_population_cumulative, 1)

#' At a national level
country_min_pop <- lapply(inf_country, function(x) min_pop_reached(x, q = 0.25)) %>%
  bind_rows(.id = "country") %>%
  filter(stratification %in% c("Area, age, behaviour", "Area, age"))

inf_country_half <- country_min_pop %>%
  group_by(stratification) %>%
  summarise(
    max = 100 * round(max(prop_population_cumulative), 3),
    median = 100 * round(median(prop_population_cumulative), 3),
    min = 100 * round(min(prop_population_cumulative), 3)
  )

inf_country_half_with_behaviour <- filter(inf_country_half, stratification == "Area, age, behaviour")
inf_country_half_without_behaviour <- filter(inf_country_half, stratification == "Area, age")

#' What proportion of new infections are among FSW as compared with the proportion the population that are FSW?
inf_fsw <- inf %>%
  filter(
    stratification == "Behaviour",
    category == "sexpaid12m"
  ) %>%
  select(prop_infections_averted_cumulative, prop_population_cumulative) %>%
  mutate(across(everything(), ~ 100 * signif(.x, digits = 3)))

#' What about by country?
inf_fsw_country <- lapply(inf_country, function(x)
  x %>%
    filter(stratification == "Behaviour", category == "sexpaid12m") %>%
    select(prop_infections_averted_cumulative, prop_population_cumulative) %>%
      mutate(across(prop_infections_averted_cumulative:prop_population_cumulative, ~ 100 * signif(.x, digits = 3)))
) %>%
  bind_rows(.id = "country")

inf_fsw_kenya <- filter(inf_fsw_country, country == "Kenya")
inf_fsw_tanzania <- filter(inf_fsw_country, country == "Tanzania")
```

For any given fraction of AGYW prioritised, substantially more new infections were reached by strategies that included behavioural risk stratification.
Reaching half of all new infections required reaching `r inf_half_without_behaviour`\% of the population when stratifying by area and age, but only `r inf_half_with_behaviour`\% when behavioural stratification was included (Fig \ref{fig:infections-reached}).
The majority of this benefit came from reaching FSW, who were `r inf_fsw$prop_population_cumulative`\% of the population but `r inf_fsw$prop_infections_averted_cumulative`\% of all new infections.

Considering each country separately, on average, reaching half of new infections required reaching `r inf_country_half_without_behaviour$median`\% (range `r inf_country_half_without_behaviour$min`-`r inf_country_half_without_behaviour$max`\%) of the population when stratifying by area and age, reducing to `r inf_country_half_with_behaviour$median`\% (range `r inf_country_half_with_behaviour$min`-`r inf_country_half_with_behaviour$max`\%) when behaviour was included.
The importance of stratifying risk upon age, location and behaviour within a country varied, analogous to the varying contribution of each to the total variance (Appendix B).
For example, FSW in Kenya were estimated to be `r inf_fsw_kenya$prop_population_cumulative`\% of the population and close to a third (`r inf_fsw_kenya$prop_infections_averted_cumulative`\%) of all new infections, whereas FSW in Tanzania were just `r inf_fsw_tanzania$prop_population_cumulative`\% of the population and `r inf_fsw_tanzania$prop_infections_averted_cumulative`\% of all new infections.

# Discussion

We estimated sexual risk group proportions for AGYW at a district-level in 13 sub-Saharan African countries with pressing HIV prevention requirements.
Our estimates will enable country and district-level planners to differentiate prevention programming according to risk behaviour, as outlined in the Global AIDS Strategy.
<!-- Some type of comment about how novel this would be if implemented -->

By considering all possible risk stratification strategies, we showed that successful implementation of a risk-stratified approach would allow substantially more new infections to be found before they occur.
A considerable proportion of these new infections are among FSW, supporting the case for HIV programming efforts focused on key population groups [@baral2012burden].
We showed that there is substantial variation in the importance of prioritisation by age, location and behaviour within each country.
This highlights the importance of understanding and tailoring HIV prevention efforts to country-specific contexts.
By standardising our analysis across all 13 countries, we showed the additional efficiency benefits of resource allocation between countries.

We found a geographic delineation in the proportion of women cohabiting between southern and eastern Africa, calling attention to a divide attributable to many cultural, social and economic factors.
The delineation does not represent a boundary between predominately Christian and Muslim populations, which is further north.
We also note that the high numbers of adolescent girls aged 15-19 cohabiting in Mozambique, reflecting existing concerns [@unicef].

Our modelled estimates improve upon direct survey results for three reasons.
First, by taking a modular modelling approach, we integrated all relevant survey information from multiple years, allowing estimation of the FSW proportion for surveys without a specific transactional sex question.
Second, whereas direct estimates exhibit large sampling variability at a district level, we alleviated this issue using spatio-temporal smoothing (Fig).
Third, we provide estimates in all settings, including districts without any survey clusters as well as years without surveys, allowing estimates to be consistently fed into further analysis and planning pipelines.

To the best of our knowledge, the only previous research to geographically map AGYW HIV risk groups is @brugh2021characterizing, who use biomaker and behavioural data from the most recent surveys in Eswatini, Haiti and Mozambique to define and subsequently map risk groups using a range of machine learning techniques.
Our work builds on [@brugh2021characterizing] by including more countries, integrating a greater number of surveys, and connecting risk group proportions with HIV epidemic indicators to help inform policy.

As well, this work serves as a case-study in how to use the multinomial-Poisson transformation to efficiently specify and fit multinomial spatio-temporal models in `R-INLA`.
Specifically, we used Kronecker products over Gaussian Markov random fields to define appropriate category-specific spatio-temporal random effects.

<!-- Paragraph about AGFS e.g. our results are consistent with age at first sex findings [@kinh2021trends]. -->

## Limitations

The risk groups we analysed did not consider other important characteristics, such as condom usage or partner-specific risk, which contribute to heterogeneity within each risk group.
Although the number of risk groups considered could be increased, capturing more of this heterogeneity, this inclination must be balanced with the benefits of parsimony.
Our approach assumed that within risk group heterogeneity is small enough that the categories are meaningfully consistent across contexts.
Additionally, the categories we used are not immediately actionable.
For example, a program is designed to reach AGYW who are cohabiting, then it is not clear how to find these individuals within a community.
It may be preferable to select risk groups based more amenable attributes, such as attendance of a particular service or facility.
<!-- e.g. school, healthcare -->

Under-reporting of higher risk sexual behaviours amongst AGYW could affect the validity of our risk group proportion estimates.
Due to social stigma or disapproval, respondents may be reluctant to report non-marital partners [@nnko2004secretive} or may bias their reporting of sexual debut [@zaba2004age; @wringe2009comparative; @kinh2021trends].
For guidance of resource allocation, differing rates of under-reporting by country, district, year or age group are particularly concerning to the applicability of our results; and, while it may be reasonable to assume a constant rate over space-time, the same cannot be said for age, where aspects of under-reporting have been shown to decline as respondents age [@glynn2011assessing], suggesting that the elevated risks we found faced by younger women are likely a conservative estimate.

Our FSW estimates do not overcome the difficulties of sampling hard to reach groups, specifically the possibility of being excluded from household sampling frames.
As well, we did not consider seasonal migration patterns, which may particularly effect FSW population sizes.

Our analysis of the number of infections that could be reached by each risk stratification strategy was based on simplifying assumptions and should therefore be interpreted as illustrating the potentially obtainable benefits, rather than benefits that would be accrued from any specific intervention strategy.
Factors we did not consider include the greater administrative burden of more complex strategies, variation in difficulty or feasibility of reaching individuals in each strata, variation in the range or effectiveness of interventions by strata, and changes in strata membership that may occur during the course of a year.

<!-- I think the Nnko 2004 is a good cite. For biases in age at first sex as folks age: -->
<!-- https://pubmed.ncbi.nlm.nih.gov/15572637/ -->
<!-- https://pubmed.ncbi.nlm.nih.gov/19307342/ -->
<!-- Then these are all about how methodological approaches can result in different estimates (I think): -->
<!-- Hewett PC, Mensch BS, Erulkar AS. Consistency in the reporting of sexual behaviour by adolescent girls in Kenya: a comparison of interviewing methods. Sex Transm Infect. 2004;80 Suppl 2:ii43-8. -->
<!-- Cleland J, Boerma JT, Carael M, Weir SS. Monitoring sexual behaviour in general populations: a synthesis of lessons of the past decade. Sex Transm Infect. 2004;80 Suppl 2:ii1-7. -->
<!-- Helleringer S, Kohler HP, Kalilani-Phiri L, Mkandawire J, Armbruster B. The reliability of sexual partnership histories: implications for the measurement of partnership concurrency during surveys. AIDS. 2011;25(4):503-11.Mensch BS, Hewett PC, Erulkar AS. The reporting of sensitive behavior by adolescents: a methodological experiment in Kenya. Demography. 2003;40(2):247-68. -->
<!-- Then thereâs the option of discussing validity of self-reported sexual behaviour based on biomarker validation (e.g. https://academic.oup.com/ofid/article/6/2/ofz010/5285444, there are more like this) but Iâm not super familiar with this literature to pull a reference that would be appropriate. -->

Finally, our analysis focused only on females aged 15-29 years and therefore did not consider optimisation of prevention for the wider population of all adults of both sexes.
By limiting our consideration to this group we didn't account for `r "num"`\% of all new infections [CITE: Katie, others].
Furthermore, obtaining population size estimates for sexual risk behaviour in the general population is a crucial step toward greater understanding the dynamics of the HIV epidemic in sub-Saharan Africa, and would allow incidence models of greater fidelity to reality which include stratification of individuals by sexual risk.

<!-- Likely over-reporting of never having had sex in the past year by young women, if we apply an RR of 0 to this group, to balance out the overall incidence rate, might be over-attributing risk to the other groups. -->
<!-- Defining condom usage is challenging, particularly for those with multiple partners, and reporting is likely biased due to social desirability. -->
<!-- Additionally, consistent condom usage is rare amongst those cohabiting, and as such likely only relevant for those with non-regular sexual partners.  -->

## Conclusion

We estimated the proportion of AGYW aged 15-19, 20-24 and 25-29 years in four sexual risk categories at a district-level in 13 priority countries.
Using these estimates, we performed an analysis of the number of infections that could be reached by prioritisation based upon location, age and behaviour.
Though subject to limitations, our results quantify the crucial importance of reaching the AGYW at highest risk.

## Supporting information

**Appendix A**: Statistical modelling \newline
**Appendix B**: Supplementary tables and figures

## Funding

AH was supported by the EPSRC Centre for Doctoral Training in Modern Statistics and Statistical Machine Learning (EP/S023151/1).
AH, VKN, KAR, JWE were supported by the Bill and Melinda Gates Foundation (OPP1190661, OPP1164897).
TMW was supported by Imperial College London (President's PhD Scholarship).
SF was supported by the EPSRC (EP/V002910/1).
JWE was supported by UNAIDS and National Institute of Allergy and Infectious Disease of the National Institutes of Health (R01AI136664). 
This research was supported by the MRC Centre for Global Infectious Disease Analysis (MR/R015600/1), jointly funded by the UK Medical Research Council (MRC) and the UK Foreign, Commonwealth \& Development Office (FCDO), under the MRC/FCDO Concordat program and is also part of the EDCTP2 programme supported by the European Union.

## Disclaimer

The findings and conclusions in this manuscript are those of the authors and do not necessarily represent the official position of the funding agencies.

# References {#references .unnumbered}
